<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>SSO接入文档</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">/*! normalize.css v3.0.1 | MIT License | git.io/normalize */

    /**
     * 1. Set default font family to sans-serif.
     * 2. Prevent iOS text size adjust after orientation change, without disabling
     *    user zoom.
     */

    html {
        font-family: sans-serif; /* 1 */
        -ms-text-size-adjust: 100%; /* 2 */
        -webkit-text-size-adjust: 100%; /* 2 */
    }

    /**
     * Remove default margin.
     */

    body {
        margin: 0;
    }

    /* HTML5 display definitions
       ========================================================================== */

    /**
     * Correct `block` display not defined for any HTML5 element in IE 8/9.
     * Correct `block` display not defined for `details` or `summary` in IE 10/11 and Firefox.
     * Correct `block` display not defined for `main` in IE 11.
     */

    article,
    aside,
    details,
    figcaption,
    figure,
    footer,
    header,
    hgroup,
    main,
    nav,
    section,
    summary {
        display: block;
    }

    /**
     * 1. Correct `inline-block` display not defined in IE 8/9.
     * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.
     */

    audio,
    canvas,
    progress,
    video {
        display: inline-block; /* 1 */
        vertical-align: baseline; /* 2 */
    }

    /**
     * Prevent modern browsers from displaying `audio` without controls.
     * Remove excess height in iOS 5 devices.
     */

    audio:not([controls]) {
        display: none;
        height: 0;
    }

    /**
     * Address `[hidden]` styling not present in IE 8/9/10.
     * Hide the `template` element in IE 8/9/11, Safari, and Firefox < 22.
     */

    [hidden],
    template {
        display: none;
    }

    /* Links
       ========================================================================== */

    /**
     * Remove the gray background color from active links in IE 10.
     */

    a {
        background: transparent;
    }

    /**
     * Improve readability when focused and also mouse hovered in all browsers.
     */

    a:active,
    a:hover {
        outline: 0;
    }

    /* Text-level semantics
       ========================================================================== */

    /**
     * Address styling not present in IE 8/9/10/11, Safari, and Chrome.
     */

    abbr[title] {
        border-bottom: 1px dotted;
    }

    /**
     * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.
     */

    b,
    strong {
        font-weight: bold;
    }

    /**
     * Address styling not present in Safari and Chrome.
     */

    dfn {
        font-style: italic;
    }

    /**
     * Address variable `h1` font-size and margin within `section` and `article`
     * contexts in Firefox 4+, Safari, and Chrome.
     */

    h1 {
        font-size: 2em;
        margin: 0.67em 0;
    }

    /**
     * Address styling not present in IE 8/9.
     */

    mark {
        background: #ff0;
        color: #000;
    }

    /**
     * Address inconsistent and variable font size in all browsers.
     */

    small {
        font-size: 80%;
    }

    /**
     * Prevent `sub` and `sup` affecting `line-height` in all browsers.
     */

    sub,
    sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }

    sup {
        top: -0.5em;
    }

    sub {
        bottom: -0.25em;
    }

    /* Embedded content
       ========================================================================== */

    /**
     * Remove border when inside `a` element in IE 8/9/10.
     */

    img {
        border: 0;
    }

    /**
     * Correct overflow not hidden in IE 9/10/11.
     */

    svg:not(:root) {
        overflow: hidden;
    }

    /* Grouping content
       ========================================================================== */

    /**
     * Address margin not present in IE 8/9 and Safari.
     */

    figure {
        margin: 1em 40px;
    }

    /**
     * Address differences between Firefox and other browsers.
     */

    hr {
        -moz-box-sizing: content-box;
        box-sizing: content-box;
        height: 0;
    }

    /**
     * Contain overflow in all browsers.
     */

    pre {
        overflow: auto;
    }

    /**
     * Address odd `em`-unit font size rendering in all browsers.
     */

    code,
    kbd,
    pre,
    samp {
        font-family: monospace, monospace;
        font-size: 1em;
    }

    /* Forms
       ========================================================================== */

    /**
     * Known limitation: by default, Chrome and Safari on OS X allow very limited
     * styling of `select`, unless a `border` property is set.
     */

    /**
     * 1. Correct color not being inherited.
     *    Known issue: affects color of disabled elements.
     * 2. Correct font properties not being inherited.
     * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.
     */

    button,
    input,
    optgroup,
    select,
    textarea {
        color: inherit; /* 1 */
        font: inherit; /* 2 */
        margin: 0; /* 3 */
    }

    /**
     * Address `overflow` set to `hidden` in IE 8/9/10/11.
     */

    button {
        overflow: visible;
    }

    /**
     * Address inconsistent `text-transform` inheritance for `button` and `select`.
     * All other form control elements do not inherit `text-transform` values.
     * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.
     * Correct `select` style inheritance in Firefox.
     */

    button,
    select {
        text-transform: none;
    }

    /**
     * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
     *    and `video` controls.
     * 2. Correct inability to style clickable `input` types in iOS.
     * 3. Improve usability and consistency of cursor style between image-type
     *    `input` and others.
     */

    button,
    html input[type="button"], /* 1 */
    input[type="reset"],
    input[type="submit"] {
        -webkit-appearance: button; /* 2 */
        cursor: pointer; /* 3 */
    }

    /**
     * Re-set default cursor for disabled elements.
     */

    button[disabled],
    html input[disabled] {
        cursor: default;
    }

    /**
     * Remove inner padding and border in Firefox 4+.
     */

    button::-moz-focus-inner,
    input::-moz-focus-inner {
        border: 0;
        padding: 0;
    }

    /**
     * Address Firefox 4+ setting `line-height` on `input` using `!important` in
     * the UA stylesheet.
     */

    input {
        line-height: normal;
    }

    /**
     * It's recommended that you don't attempt to style these elements.
     * Firefox's implementation doesn't respect box-sizing, padding, or width.
     *
     * 1. Address box sizing set to `content-box` in IE 8/9/10.
     * 2. Remove excess padding in IE 8/9/10.
     */

    input[type="checkbox"],
    input[type="radio"] {
        box-sizing: border-box; /* 1 */
        padding: 0; /* 2 */
    }

    /**
     * Fix the cursor style for Chrome's increment/decrement buttons. For certain
     * `font-size` values of the `input`, it causes the cursor style of the
     * decrement button to change from `default` to `text`.
     */

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        height: auto;
    }

    /**
     * 1. Address `appearance` set to `searchfield` in Safari and Chrome.
     * 2. Address `box-sizing` set to `border-box` in Safari and Chrome
     *    (include `-moz` to future-proof).
     */

    input[type="search"] {
        -webkit-appearance: textfield; /* 1 */
        -moz-box-sizing: content-box;
        -webkit-box-sizing: content-box; /* 2 */
        box-sizing: content-box;
    }

    /**
     * Remove inner padding and search cancel button in Safari and Chrome on OS X.
     * Safari (but not Chrome) clips the cancel button when the search input has
     * padding (and `textfield` appearance).
     */

    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none;
    }

    /**
     * Define consistent border, margin, and padding.
     */

    fieldset {
        border: 1px solid #c0c0c0;
        margin: 0 2px;
        padding: 0.35em 0.625em 0.75em;
    }

    /**
     * 1. Correct `color` not being inherited in IE 8/9/10/11.
     * 2. Remove padding so people aren't caught out if they zero out fieldsets.
     */

    legend {
        border: 0; /* 1 */
        padding: 0; /* 2 */
    }

    /**
     * Remove default vertical scrollbar in IE 8/9/10/11.
     */

    textarea {
        overflow: auto;
    }

    /**
     * Don't inherit the `font-weight` (applied by a rule above).
     * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.
     */

    optgroup {
        font-weight: bold;
    }

    /* Tables
       ========================================================================== */

    /**
     * Remove most spacing between table cells.
     */

    table {
        border-collapse: collapse;
        border-spacing: 0;
    }

    td,
    th {
        padding: 0;
    }

    /* mscore */
    * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

    *:before,
    *:after {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

    html {
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        /*font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;*/
        font-family: 'Helvetica Neue', Helvetica, Arial, 'Microsoft Yahei', sans-serif;
        font-size: 14px;
        line-height: 1.42857143;
        color: #333333;
        background-color: #ffffff;
    }

    input,
    button,
    select,
    textarea {
        font-family: inherit;
        font-size: inherit;
        line-height: inherit;
    }

    a {
        color: #428bca;
        text-decoration: none;
    }

    a:hover,
    a:focus {
        color: #2a6496;
        text-decoration: underline;
    }

    a:focus {
        outline: thin dotted;
        outline: 5px auto -webkit-focus-ring-color;
        outline-offset: -2px;
    }

    figure {
        margin: 0;
    }

    img {
        vertical-align: middle;
    }

    /*
    Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
    */

    .hljs {
        display: block;
        overflow-x: auto;
        padding: 0.5em;
        background: #f0f0f0;
        -webkit-text-size-adjust: none;
    }

    .hljs,
    .hljs-subst,
    .hljs-tag .hljs-title,
    .nginx .hljs-title {
        color: black;
    }

    .hljs-string,
    .hljs-title,
    .hljs-constant,
    .hljs-parent,
    .hljs-tag .hljs-value,
    .hljs-rules .hljs-value,
    .hljs-preprocessor,
    .hljs-pragma,
    .haml .hljs-symbol,
    .ruby .hljs-symbol,
    .ruby .hljs-symbol .hljs-string,
    .hljs-template_tag,
    .django .hljs-variable,
    .smalltalk .hljs-class,
    .hljs-addition,
    .hljs-flow,
    .hljs-stream,
    .bash .hljs-variable,
    .apache .hljs-tag,
    .apache .hljs-cbracket,
    .tex .hljs-command,
    .tex .hljs-special,
    .erlang_repl .hljs-function_or_atom,
    .asciidoc .hljs-header,
    .markdown .hljs-header,
    .coffeescript .hljs-attribute {
        color: #800;
    }

    .smartquote,
    .hljs-comment,
    .hljs-annotation,
    .diff .hljs-header,
    .hljs-chunk,
    .asciidoc .hljs-blockquote,
    .markdown .hljs-blockquote {
        color: #888;
    }

    .hljs-number,
    .hljs-date,
    .hljs-regexp,
    .hljs-literal,
    .hljs-hexcolor,
    .smalltalk .hljs-symbol,
    .smalltalk .hljs-char,
    .go .hljs-constant,
    .hljs-change,
    .lasso .hljs-variable,
    .makefile .hljs-variable,
    .asciidoc .hljs-bullet,
    .markdown .hljs-bullet,
    .asciidoc .hljs-link_url,
    .markdown .hljs-link_url {
        color: #080;
    }

    .hljs-label,
    .hljs-javadoc,
    .ruby .hljs-string,
    .hljs-decorator,
    .hljs-filter .hljs-argument,
    .hljs-localvars,
    .hljs-array,
    .hljs-attr_selector,
    .hljs-important,
    .hljs-pseudo,
    .hljs-pi,
    .haml .hljs-bullet,
    .hljs-doctype,
    .hljs-deletion,
    .hljs-envvar,
    .hljs-shebang,
    .apache .hljs-sqbracket,
    .nginx .hljs-built_in,
    .tex .hljs-formula,
    .erlang_repl .hljs-reserved,
    .hljs-prompt,
    .asciidoc .hljs-link_label,
    .markdown .hljs-link_label,
    .vhdl .hljs-attribute,
    .clojure .hljs-attribute,
    .asciidoc .hljs-attribute,
    .lasso .hljs-attribute,
    .coffeescript .hljs-property,
    .hljs-phony {
        color: #88f;
    }

    .hljs-keyword,
    .hljs-id,
    .hljs-title,
    .hljs-built_in,
    .css .hljs-tag,
    .hljs-javadoctag,
    .hljs-phpdoc,
    .hljs-dartdoc,
    .hljs-yardoctag,
    .smalltalk .hljs-class,
    .hljs-winutils,
    .bash .hljs-variable,
    .apache .hljs-tag,
    .hljs-type,
    .hljs-typename,
    .tex .hljs-command,
    .asciidoc .hljs-strong,
    .markdown .hljs-strong,
    .hljs-request,
    .hljs-status {
        font-weight: bold;
    }

    .asciidoc .hljs-emphasis,
    .markdown .hljs-emphasis {
        font-style: italic;
    }

    .nginx .hljs-built_in {
        font-weight: normal;
    }

    .coffeescript .javascript,
    .javascript .xml,
    .lasso .markup,
    .tex .hljs-formula,
    .xml .javascript,
    .xml .vbscript,
    .xml .css,
    .xml .hljs-cdata {
        opacity: 0.5;
    }

    #container {
        padding: 15px;
        margin-left: 20px;
    }

    pre {
        border: 1px solid #ccc;
        border-radius: 4px;
        display: block;
    }

    pre code {
        white-space: pre-wrap;
    }

    .hljs,
    code {
        font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;
    }

    pre {
        background-color: #dddddd;
        padding: 8px 0px 8px 30px;
        word-wrap: break-word;
    }

    table tbody tr:nth-child(2n) {
        background: rgba(158, 188, 226, 0.12);
    }

    :not(pre) > code {
        padding: 2px 4px;
        font-size: 90%;
        color: #c7254e;
        background-color: #f9f2f4;
        white-space: nowrap;
        border-radius: 4px;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 6px 12px;
    }

    blockquote {
        border-left-width: 10px;
        background-color: rgba(102, 128, 153, 0.05);
        border-top-right-radius: 5px;
        border-bottom-right-radius: 5px;
        padding: 1px 20px
    }

    blockquote.pull-right small:before, blockquote.pull-right .small:before {
        content: ''
    }

    blockquote.pull-right small:after, blockquote.pull-right .small:after {
        content: '\00A0 \2014'
    }

    blockquote:before, blockquote:after {
        content: ""
    }

    blockquote {
        margin: 0 0 1.1em
    }

    blockquote p {
        margin-bottom: 1.1em;
        font-size: 1em;
        line-height: 1.45
    }

    blockquote ul:last-child, blockquote ol:last-child {
        margin-bottom: 0
    }

    blockquote {
        margin: 0 0 21px;
        border-left: 10px solid #dddddd;
    }</style>
</head>
<body>
<div id="container">
    <h1 id="-center-font-color-red-size-72-sso-font-center-">
        <center><font size="72" color="red">SSO</font></center>
    </h1>
    <h2 id="1-sso-">1.sso流程图</h2>
    <center><img src="https://beautybond.oss-cn-shenzhen.aliyuncs.com/test/public-read/SSO_liyang.jpg" alt="输入图片说明">
    </center>


    <h2 id="2-client-">2.client接入</h2>
    <h3 id="2-1-">2.1 配置拦截器</h3>
    <pre><code><span class="hljs-annotation">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span
                class="hljs-title">MyWebMvcConfigurer</span> <span class="hljs-keyword">extends</span> <span
                class="hljs-title">WebMvcConfigurationSupport</span> </span>{

    <span class="hljs-comment">//放行路径配置文件配置</span>
    <span class="hljs-annotation">@Value</span>(<span class="hljs-string">"#{'${mvc.excludePath}'.split(',')}"</span>)
    <span class="hljs-keyword">private</span> List&lt;String&gt; excludePath;


    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">addInterceptors</span><span
            class="hljs-params">(InterceptorRegistry registry)</span> </span>{
        registry.addInterceptor(<span class="hljs-keyword">new</span> PermissionInterceptor()).addPathPatterns(<span
                class="hljs-string">"/**"</span>).excludePathPatterns(excludePath);
        <span class="hljs-keyword">super</span>.addInterceptors(registry);
    }


    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">addResourceHandlers</span><span
            class="hljs-params">(ResourceHandlerRegistry registry)</span> </span>{
        <span class="hljs-comment">//一些静态资源放行</span>
        registry.addResourceHandler(<span class="hljs-string">"/**"</span>).addResourceLocations(<span
                class="hljs-string">"classpath:/static/"</span>);
        registry.addResourceHandler(<span class="hljs-string">"/webjars/**"</span>).addResourceLocations(<span
                class="hljs-string">"classpath:/META-INT/resource/webjars"</span>);

        <span class="hljs-keyword">super</span>.addResourceHandlers(registry);
    }
}
</code></pre>
    <p><br></p>
    <h3 id="2-2-application-properties">2.2 application.properties</h3>
    <blockquote>
        <p>sso接口地址可以通过配置文件动态配置 需要解决拦截器属性获取问题</p>
    </blockquote>
    <pre><code><span class="hljs-comment">// .....</span>

<span class="hljs-comment"># 放行路径 如:登录...</span>
mvc.excludePath=/member/page3,/member/login,/login.html,/favicon.ico,/error

<span class="hljs-comment">#-------sso动态配置------------------</span>
<span class="hljs-comment">#sso服务login地址</span>
sso.server.path=https:<span class="hljs-comment">//usercentre-dev.cdhnf.cn/sso/login</span>
<span class="hljs-comment">#sso服务生成的系统编码</span>
sso.server.systemCode=SSO_B
<span class="hljs-comment">#自身项目对应的登录页面</span>
sso.server.loginUrl=http:<span class="hljs-comment">//systemb:36538/login.html</span>
<span class="hljs-comment">#sso服务验证ssoToken地址</span>
sso.server.validate=https:<span class="hljs-comment">//usercentre-dev.cdhnf.cn/sso/validatevalidate</span>
</code></pre>
    <p><br></p>
    <h3 id="2-3-">2.3 拦截器实现</h3>
    <pre><code> <span class="hljs-keyword">public</span> <span class="hljs-class"><span
            class="hljs-keyword">class</span> <span class="hljs-title">PermissionInterceptor</span> <span
            class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>{


    <span class="hljs-javadoc">/**
     *  需要解决拦截器使用<span class="hljs-javadoctag"> @Value</span>失效问题
     */</span>
    <span class="hljs-annotation">@Value</span>(<span class="hljs-string">"${sso.server.path}"</span>)
    <span class="hljs-keyword">private</span> String serverPath;
    <span class="hljs-annotation">@Value</span>(<span class="hljs-string">"${sso.server.systemCode}"</span>)
    <span class="hljs-keyword">private</span> String systemCode;
    <span class="hljs-annotation">@Value</span>(<span class="hljs-string">"${sso.server.loginUrl}"</span>)
    <span class="hljs-keyword">private</span> String loginUrl;
    <span class="hljs-annotation">@Value</span>(<span class="hljs-string">"${sso.server.validate}"</span>)
    <span class="hljs-keyword">private</span> String validateUrl;


    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span
            class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span
            class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-comment">//如从头部获取sso_token</span>
        String ssoToken = request.getHeader(<span class="hljs-string">"sso_token"</span>);
        <span class="hljs-comment">//头部获取失败再尝试从参数获取 因为sso验证成功重定向回来是将ssoToken拼地址上</span>
        <span class="hljs-keyword">if</span> (ssoToken == <span class="hljs-keyword">null</span>) {
            ssoToken = request.getParameter(<span class="hljs-string">"sso_token"</span>);
        }
        <span class="hljs-comment">//获取本次请求资源地址</span>
        String redirectUrl = request.getRequestURL().toString();
        <span class="hljs-comment">//判断ssoToken 是否存在</span>
        <span class="hljs-keyword">if</span> (ssoToken == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">//如果不存在重定向到sso服务的登录 并带上资源地址,登录地址,和系统编码(SSO服务生成)</span>
            response.sendRedirect(<span
                class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/login?redirectUrl="</span> + redirectUrl + <span
                class="hljs-string">"&amp;loginUrl=http://systemb:36537/login.html&amp;systemCode=SSO_A"</span>);
            <span class="hljs-comment">//拦截本次请求</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-comment">//如果ssoToken 存在</span>
        <span class="hljs-comment">//调用sso服务验证ssoToken 接口进行验证</span>
        CloseableHttpClient httpClient = HttpClients.createDefault();
        HttpGet httpGet = <span class="hljs-keyword">new</span> HttpGet(<span class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/validate?ssoToken="</span> + ssoToken + <span
                class="hljs-string">"&amp;systemCode=SSO_A"</span>);
        HttpResponse httpResponse = httpClient.execute(httpGet);
        <span class="hljs-comment">// 发送成功</span>
        String info = EntityUtils.toString(httpResponse.getEntity());
        Map map = JSONObject.parseObject(info, Map.class);
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"200"</span>.equals(map.get(<span
                class="hljs-string">"code"</span>).toString())) {
            <span class="hljs-comment">//token 验证成功 把ssoToken存入cookie ,前台处理cookie把ssoToken放到请求头</span>
            Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">"sso_token"</span>, ssoToken);
            response.addCookie(cookie);
            <span class="hljs-comment">//放行请求</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//token 验证失败 重定向到sso服务的登录 并带上资源地址,登录地址,和系统编码(SSO服务生成)</span>
            response.sendRedirect(<span
                class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/login?redirectUrl="</span> + redirectUrl + <span
                class="hljs-string">"&amp;loginUrl=http://systemb:36538/login.html&amp;systemCode=SSO_B"</span>);
             <span class="hljs-comment">//拦截本次请求</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
    }


}
</code></pre>
    <p><br></p>
    <h3 id="2-4-">2.4 系统自身登录</h3>
    <pre><code>    @PostMapping(<span class="hljs-string">"/login"</span>)
    private <span class="hljs-keyword">void</span> login(@RequestParam(<span
                class="hljs-string">"userName"</span>) <span class="hljs-built_in">String</span> userName, @RequestParam(<span
                class="hljs-string">"pwd"</span>) <span
                class="hljs-built_in">String</span> pwd, @RequestParam(value = <span
                class="hljs-string">"redirectUrl"</span>, required = <span class="hljs-literal">false</span>) <span
                class="hljs-built_in">String</span> redirectUrl, HttpServletResponse response, HttpServletRequest request) throws IOException {
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"123"</span>.equals(userName) &amp;&amp; <span
                class="hljs-string">"123"</span>.equals(pwd)) {
           <span class="hljs-comment">//登录成功 调用sso服务获取ssoToken</span>
            CloseableHttpClient httpClient = HttpClients.createDefault();
            HttpPost post = <span class="hljs-keyword">new</span> HttpPost(<span class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/getToken"</span>);
            JSONObject json = <span class="hljs-keyword">new</span> JSONObject();
            <span class="hljs-comment">//生成token 最少需要loginName参数</span>
            json.put(<span class="hljs-string">"loginName"</span>, <span class="hljs-string">"admin"</span>);
            <span class="hljs-comment">//json.put("k", "v");......</span>
            StringEntity userInfo = <span class="hljs-keyword">new</span> StringEntity(json.toString(), ContentType.APPLICATION_JSON);
            post.setEntity(userInfo);
            HttpResponse httpResponse = httpClient.execute(post);
            <span class="hljs-comment">// 发送成功</span>
            <span class="hljs-built_in">String</span> data = EntityUtils.toString(httpResponse.getEntity());
            <span class="hljs-built_in">Map</span> map = JSONObject.parseObject(data, <span
                class="hljs-built_in">Map</span>.class);
            <span class="hljs-built_in">String</span> ssoToken = map.get(<span class="hljs-string">"data"</span>).toString();
            System.out.println();
            Cookie cookie = <span class="hljs-keyword">new</span> Cookie(<span class="hljs-string">"sso_token"</span>, ssoToken);
            response.addCookie(cookie);
            <span class="hljs-comment">//再重定向到 重定向到sso服务的登录 并带上资源地址,登录地址,系统编码(SSO服务生成),和获取的ssoToken</span>
            response.sendRedirect(<span
                class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/login?redirectUrl="</span> + redirectUrl + <span
                class="hljs-string">"&amp;loginUrl=http://systemb:36538/login.html&amp;ssoToken="</span> + ssoToken + <span
                class="hljs-string">"&amp;systemCode=SSO_B"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//登录失败 重新登录</span>
            response.sendRedirect(<span class="hljs-string">"http://systemb:36538/login.html?redirectUrl="</span> + redirectUrl);
        }
    }
</code></pre>
    <p><br></p>
    <h3 id="2-5-">2.5 系统退出登录</h3>
    <h4 id="2-5-1-">2.5.1 接口调用</h4>
    <pre><code>    <span class="hljs-annotation">@GetMapping</span>(<span class="hljs-string">"/logout"</span>)
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span
            class="hljs-title">logout</span><span class="hljs-params">(HttpServletResponse response)</span> <span
            class="hljs-keyword">throws</span> IOException </span>{
        <span class="hljs-comment">//自身逻辑处理</span>
         .....
        <span class="hljs-comment">//调用sso退出登录 参数当前登录人的登录名</span>
        CloseableHttpClient httpClient = HttpClients.createDefault();
        HttpGet httpGet = <span class="hljs-keyword">new</span> HttpGet(<span class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/ssoLogout?loginName="</span> + <span
                class="hljs-string">"admin"</span>);
        httpClient.execute(httpGet);
        <span class="hljs-comment">//然后重定向自己的登录页面</span>
        response.sendRedirect(<span class="hljs-string">"http://systemb:36538/login.html"</span>);
    }
</code></pre>
    <h4 id="2-5-2-">2.5.2 也可以把退出写到拦截器中</h4>
    <pre><code>   <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span
            class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span
            class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-comment">//</span>
        String redirectUrl = request.getRequestURL().toString();
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"/logout"</span>.equals(redirectUrl)) {
            <span class="hljs-comment">//调用sso退出登录 参数当前登录人的登录名</span>
            CloseableHttpClient httpClient = HttpClients.createDefault();
            HttpGet httpGet = <span class="hljs-keyword">new</span> HttpGet(<span class="hljs-string">"https://usercentre-dev.cdhnf.cn/sso/ssoLogout?loginName="</span> + <span
                class="hljs-string">"admin"</span>);
            httpClient.execute(httpGet);
            <span class="hljs-comment">//然后重定向自己的登录页面</span>
            response.sendRedirect(<span class="hljs-string">"http://systemb:36538/login.html"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-comment">//判断请求是否为退出再处理</span>
        String ssoToken = request.getHeader(<span class="hljs-string">"sso_token"</span>);
</code></pre>
</div>
</body>
</html>